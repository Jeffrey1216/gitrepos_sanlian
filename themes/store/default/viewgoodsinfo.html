<div class="dtl_level2bg">
      <div class="dtl_showpro">
          <div class="dtl_showpro_l">
              <div class="dtl_smallimg">
				<div id="dtl_sml_previous"></div>
				<div id="dtl_small_box">
	                  <ul id="dtl_small_list"> 
	                  	<!-- {foreach from=$images_arr item=image name=show} -->
	                  	<!-- {if $smarty.foreach.show.iteration eq 1} -->                   					
						<li id="dtl_small_list_hover" yimage="{$image.yimage_url}"  bigimg ="{$image.thumbnail}"><img src="{$image.thumbnail}"/></li>
						<!-- {else} -->	
						<li class="" yimage="{$image.yimage_url}" bigimg="{$image.thumbnail}"><img src="{$image.thumbnail}"/></li>
						<!-- {/if} -->
		      			<!-- {/foreach} -->	
	                  </ul>
				</div>
				<div id="dtl_sml_next"></div>
              </div>
            <div id="dtl_my_glass">
				<div id="dtl_my_small"> <span id="dtl_my_mark"></span> <span id="dtl_my_float"></span><img src="{$images_arr.0.thumbnail}"/></div>
				<div id="dtl_my_big"><img id="dtl_my_big_img" src="{$images_arr.0.yimage_url}"/></div>
			</div>
        </div>
	<div class="dtl_showpro_r">
		<div>
			<h2>
				<span style="float: left;">{$data.goods.goods_name}</span>
				<!-- {if $store_info} -->
				<div class="dtl_shop_sign">
					<div class="dtl_shop_l">
					</div>
	
					<div class="dtl_shop_m">
						<span><a href="index.php?app=store_league&act=view&id={$store_id}" target="_blank" hidefocus="true" >{$store_info.store_name}</a></span>
					</div>
					<div class="dtl_shop_r">
				</div>
				</div>
				<!-- {/if} -->
			</h2>
			<div><span>编&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;号：{$data.goods_number}</span></div>
			<div><span>品&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;牌：{$data.goods.brand}</span></div>
			<div>派&nbsp;&nbsp;啦&nbsp;&nbsp;价：<span class="dtl_newprice" ectype="goods_price">￥{$data.goods.price}</span></div>
			<div>配&nbsp;&nbsp;送&nbsp;&nbsp;PL：<span class="dtl_newprice" ectype="goods_credit">{$data.goods.credit}PL</span></div>
			<div>运&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;费：<span>买家承担运费</span></div>
			<div>累&nbsp;计&nbsp;销售：<span><strong style="color:#db6d0c">{if !$data.goods.sales}0{else}{$data.goods.sales}{/if}</strong></span>&nbsp;&nbsp;件</div>
			<div>评&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：<span class="dtl_evaluation_ico"></span></div>
		</div>
		<ul class="ware_btn">
			<div class="ware_cen" style="display:none">
				<div class="ware_center">
					<h1>
						<span class="dialog_title">{$lang.add_to_cart_ok}</span>
						<span class="close_link" title="{$lang.close}" onmouseover="this.className = 'close_hover'" onmouseout="this.className = 'close_link'" onclick="slideUp_fn();"></span>
					</h1>
					<div class="ware_cen_btn">
						<p class="ware_text_p">{$lang.cart_status}</p>
						<p class="ware_text_btn">                
							<input type="submit" class="btn1" name="" value="{$lang.view_cart}" onclick="location.href='{$site_url}/index.php?app=cart'" />
							<!-- {if $store_id} -->
							<input type="submit" class="btn2" name="" value="{$lang.continue_buy}" onclick="window.location.href='{$site_url}/index.php?app=store_league&act=view&id={$store_id}';$('.ware_cen').css({'display':'none'});" />
							<!-- {else} -->
							<input type="submit" class="btn2" name="" value="{$lang.continue_buy}" onclick="$('.ware_cen').css({'display':'none'});" />
							<!-- {/if} -->
						</p>
					</div>
				</div>
			<div class="ware_cen_bottom"></div>
			</div>			   
		</ul>		 
	</div>					
	<script>
		$(function(){
		    var ipt_img = $("#btn_list > li");
		    ipt_img.hover(function(){
		        $(this).find("ul:not(:animated)").slideDown("fast");
		    },function(){
		        $(this).find("ul").slideUp("fast");
		    });
		});
		</script>
		<div class="clear"></div>
		<script type="text/javascript" src="{lib file=goodsinfo.js}" charset="utf-8"></script> 
        
    </div>
</div>	
<script type="text/javascript">
//<!CDATA[
var SITE_URL = '{$SITE_URL}';
var specs = new Array();
<!--{foreach from=$goods._specs item=spec}-->
specs.push(new specObj({$spec.spec_id}, '{$spec.spec_1|escape}', '{$spec.spec_2|escape}', {$spec.price}, {$spec.stock},{$spec.credit}));
<!--{/foreach}-->
var specQty = {$goods.spec_qty};
var defSpec = {$goods.default_spec|escape};
var goodsspec = new goodsspecObj(specs, specQty, defSpec);
var store_id = {$goods.store_id|default: 0};
/* spec对象 */
function specObj(id, spec1, spec2, price, stock, credit)
{
    this.id    = id;
    this.spec1 = spec1;
    this.spec2 = spec2;
    this.price = price;
    this.stock = stock;
    this.credit = credit;
}
/* goodsspec对象 */
function goodsspecObj(specs, specQty, defSpec)
{
    this.specs = specs;
    this.specQty = specQty;
    this.defSpec = defSpec;
    this.spec1 = null;
    this.spec2 = null;
    if (this.specQty >= 1)
    {
        for(var i = 0; i < this.specs.length; i++)
        {
            if (this.specs[i].id == this.defSpec)
            {
                this.spec1 = this.specs[i].spec1;
                if (this.specQty >= 2)
                {
                    this.spec2 = this.specs[i].spec2;
                }
                break;
            }
        }
    }

    // 取得某字段的不重复值，如果有spec1，以此为条件
    this.getDistinctValues = function(field, spec1)
    {
        var values = new Array();
        for (var i = 0; i < this.specs.length; i++)
        {
            var value = this.specs[i][field];
            if (spec1 != '' && spec1 != this.specs[i].spec1) continue;
            if ($.inArray(value, values) < 0)
            {
                values.push(value);
            }
        }
        return (values);
    }

    // 取得选中的spec
    this.getSpec = function()
    {
        for (var i = 0; i < this.specs.length; i++)
        {
            if (this.specQty >= 1 && this.specs[i].spec1 != this.spec1) continue;
            if (this.specQty >= 2 && this.specs[i].spec2 != this.spec2) continue;

            return this.specs[i];
        }
        return null;
    }

    // 初始化
    this.init = function()
    {
        if (this.specQty >= 1)
        {
            var spec1Values = this.getDistinctValues('spec1', '');
            for (var i = 0; i < spec1Values.length; i++)
            {
                if (spec1Values[i] == this.spec1)
                {
                    $(".handle ul:eq(0)").append("<li class='solid' onclick='selectSpec(1, this)'>" + spec1Values[i] + "</li>");
                }
                else
                {
                    
                    $(".handle ul:eq(0)").append("<li class='dotted' onclick='selectSpec(1, this)'>" + spec1Values[i] + "</li>");
                }
            }
        }
        if (this.specQty >= 2)
        {
            var spec2Values = this.getDistinctValues('spec2', this.spec1);
            for (var i = 0; i < spec2Values.length; i++)
            {
                if (spec2Values[i] == this.spec2)
                {
                    $(".handle ul:eq(1)").append("<li class='solid' onclick='selectSpec(2, this)'>" + spec2Values[i] + "</li>");
                }
                else
                {
                    $(".handle ul:eq(1)").append("<li class='dotted' onclick='selectSpec(2, this)'>" + spec2Values[i] + "</li>");
                }
            }
        }
        var spec = this.getSpec();
        $("[ectype='current_spec']").html(spec.spec1 + ' ' + spec.spec2);
    }
}
$(function(){
    goodsspec.init(); 
});
/*计算库存数*/
function quan()
{
	var quantity = 0 ; //初始化变量
	var quantity = {$goods._specs.0.stock} ; //给数量赋值
	var quan = $("#quantity").val();
	if (quan > quantity)
	{
		alert("您所输入的数量，超过库存数");
		$("#quantity").val(quantity);
	}
	
} 

/* buy */
function buy()
{
    if (goodsspec.getSpec() == null)
    {
        alert(lang.select_specs);
        return;
    }
    var spec_id = goodsspec.getSpec().id;

    var quantity = $("#quantity").val();
    if (quantity == '')
    {
        alert(lang.input_quantity);
        return;
    }
    if (parseInt(quantity) < 1)
    {
        alert(lang.invalid_quantity);
        return;
    }
    add_to_cart(spec_id, quantity);
}

/* add cart */
function add_to_cart(spec_id, quantity)
{
    var url = SITE_URL + '/index.php?app=cart&act=add';
    $.getJSON(url, {'spec_id':spec_id, 'quantity':quantity, 'store_id':store_id}, function(data){
        if (data.done)
        {
            $('.bold_num').text(data.retval.cart.kinds);
            $('.bold_mly').html(price_format(data.retval.cart.amount));
            $('.ware_cen').slideDown('slow');
            setTimeout(slideUp_fn, 15000);
        }
        else
        {
            alert(data.msg);
        }
    });
}
function to_buy() {
	if (goodsspec.getSpec() == null)
    {
        alert(lang.select_specs);
        return;
    }
    var spec_id = goodsspec.getSpec().id;

    var quantity = $("#quantity").val();
    if (quantity == '')
    {
        alert(lang.input_quantity);
        return;
    }
    if (parseInt(quantity) < 1)
    {
        alert(lang.invalid_quantity);
        return;
    }
    
	var url = SITE_URL + '/index.php?app=cart&act=add';
    $.getJSON(url, {'spec_id':spec_id, 'quantity':quantity, 'store_id' : store_id}, function(data){
    	if (data.done)
        {
            $('.bold_num').text(data.retval.cart.kinds);
            $('.bold_mly').html(price_format(data.retval.cart.amount));
            location.href='{$site_url}/index.php?app=cart';
        }
        else
        {
            alert(data.msg);
        }
    });
	
};

//]]>

</script>
<script type="text/javascript" src="{lib file=js/loup.js}" charset="gbk"></script>
